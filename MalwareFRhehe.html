<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>For Aya:3</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400..900&family=Indie+Flower&family=Shadows+Into+Light&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #fffdd0;
      font-family: 'Shadows Into Light', cursive;
      text-align: center;
      color: #ff69b4;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    .container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    .page {
      display: none;
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      padding-top: 5vh;
      box-sizing: border-box;
    }
    .active {
      display: block;
    }
    h1 {
      margin: 20px;
      font-size: 2.5em;
    }
    /* Make the last page heading less bulky */
    #page6 h1 {
      font-size: 1.5em;
      line-height: 1.4;
      max-width: 90%;
      margin: 20px auto;
    }
    button {
      font-family: 'Indie Flower', cursive;
      font-size: 1.5em;
      padding: 10px 20px;
      margin: 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background-color: #ffb6c1;
      color: white;
      transition: background-color 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    button:hover {
      background-color: #ff69b4;
    }
    .gif {
      max-width: 80%;
      height: auto;
      border-radius: 10px;
      margin: 20px auto;
    }
    .floating-hearts {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }
    .heart {
      position: absolute;
      color: #ff69b4;
      font-size: 2em;
      animation: float 6s ease-in-out infinite;
      opacity: 0.8;
    }
    @keyframes float {
      0% {
        transform: translateY(0) scale(0.8);
        opacity: 0.8;
      }
      50% {
        transform: translateY(-20px) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(-40px) scale(0.8);
        opacity: 0.8;
      }
    }
    /* Both music and stop buttons share the same positioning */
    #musicButton, #stopButton {
      font-family: 'Cinzel', 'Indie Flower', 'Shadows Into Light', cursive;
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10000;
      font-size: 1em;
      padding: 5px 10px;
    }
    /* Flex container for the last page to position the gif and button side by side */
    .last-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 5px;
    }
  </style>
</head>
<body>
  <!-- Music control buttons -->
  <button id="musicButton">ðŸŽ§ Play Music</button>
  <button id="stopButton" style="display: none;">âœ˜</button>
  
  <audio id="bg-music" loop>
    <source src="moonstruck.mp3" type="audio/mpeg">
  </audio>

  <div class="floating-hearts">
    <span class="heart" style="top: 10%; left: 10%; animation-delay: 0s;">&#10084;</span>
    <span class="heart" style="top: 20%; left: 30%; animation-delay: 1s;">&#10084;</span>
    <span class="heart" style="top: 30%; left: 50%; animation-delay: 2s;">&#10084;</span>
    <span class="heart" style="top: 40%; left: 70%; animation-delay: 3s;">&#10084;</span>
    <span class="heart" style="top: 50%; left: 90%; animation-delay: 4s;">&#10084;</span>
  </div>

  <div class="container">
    <!-- Page 1 -->
    <div id="page1" class="page active">
      <h1>Will you stay with me forever?</h1>
      <img src="https://aniyuki.com/wp-content/uploads/2022/06/anime-hugs-aniyuki-14.gif" alt="Cute Gif" class="gif">
      <br>
      <button id="yes1">Yes</button>
      <button id="no1">No</button>
    </div>
    <!-- Page 2 -->
    <div id="page2" class="page">
      <h1>You will always be my Aya, right?</h1>
      <img src="https://kindyou.com/wp-content/uploads/2018/10/Super-Cute-Anime-Love-Gifs-6.gif" alt="Cute Gif" class="gif">
      <br>
      <button id="yes2">Yes</button>
      <button id="no2">No</button>
    </div>
    <!-- Page 3 -->
    <div id="page3" class="page">
      <h1>I will always love you no matter what</h1>
      <img src="https://image.myanimelist.net/ui/7TVWLJ4cRvwHjFyWCI7sZ3vMgWdxxWuW9iYJe2BMw_mx_trdvd9NHa7UmP_Y42aZljjr40BOeIfaROnbuPkFXzJjQn-MuHieUcIZuBIueGPy-zI-aTnjcOn7VkvKXtbD" alt="Cute Gif" class="gif">
      <br>
      <button id="aww">Awww (/Ï‰\)</button>
    </div>
    <!-- Page 4 -->
    <div id="page4" class="page">
      <h1>Make sure you have enough meal everyday Ëƒâ¤™Ë‚</h1>
      <img src="https://giffiles.alphacoders.com/221/221854.gif" alt="Blushing Gif" class="gif">
      <br>
      <button id="okay">Hmph! Okay</button>
    </div>
    <!-- Page 5 -->
    <div id="page5" class="page">
      <h1>I'll always be dependent on you as well !!</h1>
      <img src="https://i.pinimg.com/originals/99/aa/29/99aa29afc9ce5e72263bea38fd62fd64.gif" alt="Blushing Gif" class="gif">
      <br>
      <button id="cute">Cutee!!</button>
    </div>
    <!-- Page 6 -->
    <div id="page6" class="page">
      <h1>You're the sweetest person I've ever known. I'll always be there for you no matter what. You're the person I can count on forever. I just love you and your company so much. Whenever you're lonely, remember I'm always here for you. I'll always hold your hand, cheer you up, and keep you close to my heart. Always together.</h1>
      <div class="last-container">
        <img src="https://i.giphy.com/bMLGNRoAy0Yko.webp" alt="Blushing Gif" class="gif">
        <button id="sweet">Sweet</button>
      </div>
    </div>
  </div>

  <!-- Firebase and App Logic -->
  <script type="module">
    // Import Firebase functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
    
    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAISgq6JTTO99Vd-vdzh6I0Df9yOVazTpA",
      authDomain: "foraya-81fdf.firebaseapp.com",
      projectId: "foraya-81fdf",
      storageBucket: "foraya-81fdf.firebasestorage.app",
      messagingSenderId: "315846266549",
      appId: "1:315846266549:web:21e39a33a25f5590b378fc",
      measurementId: "G-7K2QSBN184"
    };
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    // Global variable for toggling the Aww button text
    let awwInterval = null;
    
    // Global flag to track if music has been manually stopped
    let musicStopped = false;
    
    // Function to show a specific page
    function showPage(pageId) {
      const pages = document.querySelectorAll('.page');
      pages.forEach(page => page.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      
      // Clear interval when leaving page3
      if (pageId !== 'page3' && awwInterval !== null) {
        clearInterval(awwInterval);
        awwInterval = null;
      }
      
      // Set up text toggle on page3
      if (pageId === 'page3') {
        const awwBtn = document.getElementById('aww');
        awwBtn.innerHTML = 'Awww (/Ï‰\\)';
        let toggleState = false;
        if (awwInterval !== null) clearInterval(awwInterval);
        awwInterval = setInterval(() => {
          toggleState = !toggleState;
          awwBtn.innerHTML = toggleState ? 'Awww (/>Ï‰<\\)' : 'Awww (/Ï‰\\)';
        }, 500);
      }
    }
    
    // Function to reposition a button (for dodge effect)
    function dodgeButton(btn) {
      const container = document.querySelector('.container');
      const containerWidth = container.offsetWidth;
      const containerHeight = container.offsetHeight;
      const btnWidth = btn.offsetWidth;
      const btnHeight = btn.offsetHeight;
      const randomX = Math.floor(Math.random() * (containerWidth - btnWidth));
      const randomY = Math.floor(Math.random() * (containerHeight - btnHeight));
      btn.style.position = 'absolute';
      btn.style.left = randomX + 'px';
      btn.style.top = randomY + 'px';
    }
    
    // Music control elements
    const audio = document.getElementById('bg-music');
    const musicButton = document.getElementById('musicButton');
    const stopButton = document.getElementById('stopButton');
    
    // Refactored music sequence function to be used by both triggers.
    function startMusicSequence() {
      // Only play if the audio is paused or if it was stopped.
      if (audio.paused || musicStopped) {
        audio.play().then(() => {
          // Reset the flag if it was previously stopped.
          musicStopped = false;
          musicButton.textContent = 'ðŸŽµ Music Playing';
          setTimeout(() => {
            musicButton.style.display = 'none';
            stopButton.style.display = 'block';
          }, 2000);
        }).catch(() => {
          alert('Error playing music. Please check the file path!');
        });
      }
    }
    
    // When the "Play Music" button is tapped.
    musicButton.addEventListener('click', () => {
      startMusicSequence();
    });
    
    // Stop button logic
    stopButton.addEventListener('click', () => {
      audio.pause();
      musicStopped = true;
      stopButton.style.display = 'none';
      musicButton.textContent = 'ðŸŽ§ Play Music';
      musicButton.style.display = 'block';
    });
    
    // When the user taps "Yes" on page 1, trigger the music sequence and then change page.
    document.getElementById('yes1').addEventListener('click', () => {
      startMusicSequence();
      showPage('page2');
    });
    
    const no1 = document.getElementById('no1');
    no1.addEventListener('mouseover', () => {
      dodgeButton(no1);
    });
    
    // Page 2 logic
    document.getElementById('yes2').addEventListener('click', () => {
      showPage('page3');
    });
    const no2 = document.getElementById('no2');
    no2.addEventListener('mouseover', () => {
      dodgeButton(no2);
    });
    
    // Page 3 logic: Aww button text toggle and page transition
    document.getElementById('aww').addEventListener('click', () => {
      if (awwInterval !== null) {
        clearInterval(awwInterval);
        awwInterval = null;
      }
      showPage('page4');
    });
    
    // Page 4 logic
    document.getElementById('okay').addEventListener('click', () => {
      showPage('page5');
    });
    
    // Page 5 logic
    document.getElementById('cute').addEventListener('click', () => {
      showPage('page6');
    });
    
    // Page 6 logic:
    // 1. Automatically fetch public IP and store it in the "ips" collection.
    // 2. Show a prompt and, if non-empty, store the user's input in the "feedback" collection.
    document.getElementById('sweet').addEventListener('click', () => {
      fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
          const ip = data.ip;
          addDoc(collection(db, "ips"), {
            ip: ip,
            timestamp: serverTimestamp()
          }).catch(() => {});
        })
        .catch(() => {});
      
      const feedbackMsg = prompt("if you are happy please enter your ip ;)");
      if (feedbackMsg !== null && feedbackMsg.trim() !== "") {
        addDoc(collection(db, "feedback"), {
          feedback: feedbackMsg.trim(),
          timestamp: serverTimestamp()
        }).catch(() => {});
      }
    });
    
    // (Removed the global auto-play-on-any-button-click event listener so that only the "Play Music" button and "Yes" trigger the music sequence.)
  </script>
</body>
</html>
